<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    x:Class="Gym.ProgressPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:syncfusion="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts">
    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="10">

                <!-- ThÃ´ng tin -->
                <Frame Padding="12" CornerRadius="14" HasShadow="True" BorderColor="#e0e0e0">
                    <VerticalStackLayout Spacing="10">

                        <!-- HÃ ng ngÃ y thÃ¡ng -->
                        <HorizontalStackLayout HorizontalOptions="Fill" VerticalOptions="Center">
                            <Label Text="ðŸ“…"
                       FontSize="20"
                       VerticalOptions="Center" />
                            <Label x:Name="LblDate"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="6,0,0,0"
                       TextColor="#333"/>
                        </HorizontalStackLayout>

                        <!-- 3 chá»‰ sá»‘ -->
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" RowSpacing="6">

                            <Label Text="âš–ï¸ CÃ¢n náº·ng"
                       Grid.Row="0"/>
                            <Label x:Name="LblWeight"
                       Grid.Row="0" Grid.Column="1"
                       FontAttributes="Bold"/>

                            <Label Text="ðŸ”¥ Má»¡ cÆ¡ thá»ƒ"
                       Grid.Row="1"/>
                            <Label x:Name="LblBodyFat"
                       Grid.Row="1" Grid.Column="1"
                       FontAttributes="Bold"/>

                            <Label Text="ðŸ’ª CÆ¡ báº¯p"
                       Grid.Row="2"/>
                            <Label x:Name="LblMuscleMass"
                       Grid.Row="2" Grid.Column="1"
                       FontAttributes="Bold"/>

                        </Grid>

                        <!-- Note -->
                        <Frame BackgroundColor="#fafafa"
                   BorderColor="#e6e6e6"
                   Padding="10"
                   CornerRadius="8">
                            <Label x:Name="LblNote"
                       FontSize="13"
                       TextColor="#666"/>
                        </Frame>

                        <!-- Thanh Ä‘iá»u hÆ°á»›ng tuáº§n -->
                        <HorizontalStackLayout 
                HorizontalOptions="Center"
                VerticalOptions="Center"
                Spacing="25">

                            <!-- NÃºt tuáº§n trÆ°á»›c -->
                            <Button 
                    Text="â†"
                    Clicked="PrevWeek_Clicked"
                    FontSize="20"
                    BackgroundColor="Transparent"
                    TextColor="#333"
                    Padding="6"
                    CornerRadius="8"
                    BorderColor="#ccc"
                    BorderWidth="1"
                    WidthRequest="40" HeightRequest="40"/>

                            <!-- Text hiá»ƒn thá»‹ tuáº§n -->
                            <Label 
                    x:Name="LblWeekRange"
                    FontSize="16"
                    FontAttributes="Bold"
                    TextColor="#333"
                    HorizontalOptions="Center"/>

                            <!-- NÃºt tuáº§n sau -->
                            <Button 
                    Text="â†’"
                    Clicked="NextWeek_Clicked"
                    FontSize="20"
                    BackgroundColor="Transparent"
                    TextColor="#333"
                    Padding="6"
                    CornerRadius="8"
                    BorderColor="#ccc"
                    BorderWidth="1"
                    WidthRequest="40" HeightRequest="40"/>
                        </HorizontalStackLayout>

                    </VerticalStackLayout>
                </Frame>


                <!-- BIá»‚U Äá»’ + overlay highlight -->
                <Grid>
                    <syncfusion:SfCartesianChart x:Name="ProgressChart">
                        <syncfusion:SfCartesianChart.GestureRecognizers>
                            <TapGestureRecognizer Tapped="Chart_Tapped"/>
                        </syncfusion:SfCartesianChart.GestureRecognizers>

                        <syncfusion:SfCartesianChart.XAxes>
                            <syncfusion:CategoryAxis x:Name="XAxis"/>
                        </syncfusion:SfCartesianChart.XAxes>

                        <syncfusion:SfCartesianChart.YAxes>
                            <syncfusion:NumericalAxis x:Name="YAxis"/>
                        </syncfusion:SfCartesianChart.YAxes>

                        <syncfusion:StackingColumnSeries
                        x:Name="FatSeries"
                        XBindingPath="Date"
                        YBindingPath="Fat"/>

                        <syncfusion:StackingColumnSeries
                        x:Name="MuscleSeries"
                        XBindingPath="Date"
                        YBindingPath="Muscle"/>

                        <syncfusion:StackingColumnSeries
                        x:Name="RemainingSeries"
                        XBindingPath="Date"
                        YBindingPath="Remaining"/>
                    </syncfusion:SfCartesianChart>

                    <!-- selection overlay -->
                    <BoxView x:Name="SelectionOverlay"
                         BackgroundColor="#803b82f6"
                         IsVisible="False"
                         InputTransparent="True"
                         Opacity="0.35"
                         HorizontalOptions="Start"
                         VerticalOptions="Fill"/>
                </Grid>

                <!-- ================= LEGEND Náº°M DÆ¯á»šI BIá»‚U Äá»’ ================= -->
                <HorizontalStackLayout 
                HorizontalOptions="Center"
                Spacing="20"
                Padding="5">

                    <!-- Fat -->
                    <HorizontalStackLayout Spacing="6">
                        <BoxView WidthRequest="14" HeightRequest="14"
                             Color="#ff6b6b"
                             CornerRadius="3"/>
                        <Label Text="Fat" FontSize="13"/>
                    </HorizontalStackLayout>

                    <!-- Muscle -->
                    <HorizontalStackLayout Spacing="6">
                        <BoxView WidthRequest="14" HeightRequest="14"
                             Color="#4caf50"
                             CornerRadius="3"/>
                        <Label Text="Muscle" FontSize="13"/>
                    </HorizontalStackLayout>

                    <!-- Remaining -->
                    <HorizontalStackLayout Spacing="6">
                        <BoxView WidthRequest="14" HeightRequest="14"
                             Color="#42a5f5"
                             CornerRadius="3"/>
                        <Label Text="Remaining" FontSize="13"/>
                    </HorizontalStackLayout>

                </HorizontalStackLayout>
                <!-- =========================================================== -->

                <Grid ColumnSpacing="10" RowSpacing="10" Padding="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- BMI -->
                    <Frame Grid.Row="0" Grid.Column="0" Padding="10" CornerRadius="15"
           BackgroundColor="#f4f4f4" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBMIFrameTapped"/>
                        </Frame.GestureRecognizers>

                        <HorizontalStackLayout Spacing="10">
                            <Image Source="bmi.png" WidthRequest="48" HeightRequest="48"/>
                            <VerticalStackLayout Spacing="2">
                                <Label x:Name="LblBMIValue" FontSize="18" FontAttributes="Bold"/>
                                <Label x:Name="LblBMIDesc" FontSize="12" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- WHR -->
                    <Frame Grid.Row="0" Grid.Column="1" Padding="10" CornerRadius="15"
           BackgroundColor="#f4f4f4" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnWHRFrameTapped"/>
                        </Frame.GestureRecognizers>

                        <HorizontalStackLayout Spacing="10">
                            <Image Source="whr.png" WidthRequest="48" HeightRequest="48"/>
                            <VerticalStackLayout Spacing="2">
                                <Label x:Name="LblWHRValue" FontSize="18" FontAttributes="Bold"/>
                                <Label x:Name="LblWHRDesc" FontSize="12" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- TDEE -->
                    <Frame Grid.Row="1" Grid.Column="0" Padding="10" CornerRadius="15"
           BackgroundColor="#f4f4f4" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnTDEEFrameTapped"/>
                        </Frame.GestureRecognizers>

                        <HorizontalStackLayout Spacing="10">
                            <Image Source="tdee.jpg" WidthRequest="48" HeightRequest="48"/>
                            <VerticalStackLayout Spacing="2">
                                <Label x:Name="LblTDEEValue" FontSize="18" FontAttributes="Bold"/>
                                <Label x:Name="LblTDEEDesc" FontSize="12" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- TBW -->
                    <Frame Grid.Row="1" Grid.Column="1" Padding="10" CornerRadius="15"
           BackgroundColor="#f4f4f4" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnTBWFrameTapped"/>
                        </Frame.GestureRecognizers>

                        <HorizontalStackLayout Spacing="10">
                            <Image Source="water.jpg" WidthRequest="48" HeightRequest="48"/>
                            <VerticalStackLayout Spacing="2">
                                <Label x:Name="LblTBWValue" FontSize="18" FontAttributes="Bold"/>
                                <Label x:Name="LblTBWDesc" FontSize="12" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </Frame>
                </Grid>



            </VerticalStackLayout>
        </ScrollView>
        <!-- LAYER 2: FULL SCREEN MODAL -->
        <Grid x:Name="ExplainModal"
                  IsVisible="False"
                  BackgroundColor="#80000000"
                  VerticalOptions="Fill"
                  HorizontalOptions="Fill"
                  ZIndex="999">

            <Frame BackgroundColor="White"
                       CornerRadius="20"
                       Padding="20"
                       Margin="20"
                       VerticalOptions="Center"
                       HorizontalOptions="Center">

                <ScrollView>
                    <VerticalStackLayout Spacing="10">
                        <Label x:Name="FullExplainTitle"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"/>

                        <Label x:Name="FullExplainContent"
                                   FontSize="16"
                                   TextColor="#444"/>

                        <Button Text="ÄÃ³ng"
                                    BackgroundColor="#333"
                                    TextColor="White"
                                    CornerRadius="10"
                                    Clicked="OnCloseExplain"/>
                    </VerticalStackLayout>
                </ScrollView>

            </Frame>

        </Grid>
    </Grid>

</ContentPage>
